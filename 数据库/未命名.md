

## 〇、屁话

数据库管理系统Database management system(简称DBMS)
它们都是独立可运行的软件,我们用java写的程序可以连接这些软件让其负责对数据进行维护
常见的DBMS:

* oracle
* mysql
* DB2
* SQLServer

如何操作DBMS?

* SQL语言:Structured Query Language
* SQL有执行标准:SQL92
* SQL语言是操作DBMS的语言,所有的DBMS都支持标准的SQL语言以及自身提供的可扩展SQL

连接数据库的方式:

1. 命令行(控制台)的客户端
     `show databases`;
2. 图形化界面的客户端
3. IDEA终极版提供了连接数据库的功能
4. 在JAVA中要是用JDBC连接数据库

SQL语句的分类:

* DDL:数据定义语言,用来操作数据库对象(数据库对象:表,索引,序列等都属于数据库对象)
      包含的语法:`CREATE,DROP,ALTER`
* DML:数据操作语言,用来操作表中的数据(包含的操作:对数据的增删改)
      包含的语法:`INSERT,UPDATE,DELETE`
* DQL:数据查询语言,用来查询表中的数据
      包含的语法:`SELECT`
* TCL:事务控制语言
      包含的语法:`COMMIT`,`ROLLBACK`
* DCL:数据控制语言,通常用来让DBA管理数据库使用

## 一、数据库操作

1. 查看DBMS里有多少个数据库
   `SHOW DATABASES`;

2. 新建一个数据库:
   `CREATE DATABASE 数据库名`
   例如:

```sql
CREATE DATABASE mydb;
```

3. 创建一个数据库时可以指定该数据库使用的字符集
   `CREATE DATABASE 数据库名 CHARSET=UTF8/GBK`
   例如:

```sql
CREATE DATABASE mydb2 CHARSET=UTF8
```

4. 查看数据库信息
   `SHOW CREATE DATABASE` 数据库名
   例如:

```sql
SHOW CREATE DATABASE mydb
```

5. 删除数据库
   `DROP DATABASE 数据库名`
   例如:

```sql
DROP DATABASE db1
DROP DATABASE db2
```

6. 使用某个指定的数据库:
   `USE 数据库名`
   例如:
   使用mydb这个数据库:

```sql
USE mydb;
```

## 二、表操作 

1. 创建表

   `CREATE TABLE 表名( 字段名1 数据类型, 字段名2 数据类型, ... ) `

   ```sql
   CREATE TABLE userinfo( id INT, username VARCHAR(30), password VARCHAR(30), nickname VARCHAR(30), age INT );
   ```

2. 查看表的详细信息

   `SHOW CREATE TABLE 表名`

3. 查看表结构

   `DESC 表名`

4. 删除表

   `DROP TABLE 表名`

   ```sql
   DROP TABLE user;
   ```

5. 修改表

   `ALTER TABLE 表名 ...`

   * 修改表名

     `RENAME TABLE 原表名 TO 新表名`

   * 修改表结构

     * 添加列

       `ALTER TABLE 表名 ADD 字段名 字段类型 [FIRST| AFTER 字段名]`

       * 在hero第一列上追加新列

         ```sql
         ALTER TABLE hero ADD id INT FIRST
         ```

       * 向user表中追加性别

         ```sql
         ALTER TABLE user ADD gender VARCHAR(10)
         ```

     * 删除表中字段

       `ALTER TABLE 表明 DROP 字段名`

     * 修改表中字段

       > *注意:可以修改表中字段的类型,长度信息.但是尽量不要在表中包含数据后再进行修改,* *否则可能因为表中现有数据违背该字段修改后的要求导致修改失败.*

       `ALTER TABLE 表名 CHANGE 字段名 新字段名 新字段类型`

       ```sql
       ALTER TABLE hero CHANGE age age VARCHAR(100)
       ```

6. 插入数据

   语法：`INSERT INTO 表名 [(字段1,字段2,...)] VALUES (字段1的值,字段2的值,...)`

   * 在数据库中,字符串是使用单引号的.

   * 在`INSERT`语句中未被指定的列在插入数据时，默认插入`NULL`值。如果未指定的列指定了默认值，则插入指定的默认值
   * 在`INSERT`语句中字段名可以忽略，若忽略则为全列插入，此时`VALUES`后指定的值的顺序，类型，个数必须与表中字段一致

7. 修改表中数据

   语法：`UPDATE 表名 SET 字段名1=字段值1[,字段名2=字段值2,....] [WHERE 过滤条件]`

   ```sql
   将张三的年龄改为22岁:
   UPDATE person
   SET age=22
   WHERE name='张三';    WHERE子句在这里的作用:仅选定表中name字段值为'张三'的记录
   
   将年龄等于15岁的人改为年龄36岁
   UPDATE person
   SET age=36
   WHERE age=15;		  满足WHERE条件的记录都会进行修改
   ```

   `WHERE`子句中常用的条件
   `=`，`<`，`>`，`<=`，`>=`，`<>`(不等于，`!=`不是所有数据库都支持)

   同时修改多个字段

   ```sql
   #将"李四"的名字改为"李老四"并且年龄改为55
   UPDATE person
   SET name='李老四',age=55
   WHERE name='李四'
   ```

   > 字符串的内容是严格区分空格，大小写的。

8. 删除表中数据

   语法：`DELETE [FROM] 表名 [WHERE 过滤条件]`

## 三、数据类型

**不同的数据库管理系统，数据类型不完全一致**

### 1. 数字类型

* 整数类型：`INT(m)`和`BIGINT(m)`

  `m`表示数字的长度（位数）

* 浮点类型：`DOUBLE(m,n)`

  * `m`表示整体数字的位数， `n`表示小数的位数
  * 实际插入数据时如果精度超过了可保存的范围时，会自动进行四舍五入

### 2. 字符类型

* `CHAR(n)`:定长字符串

  * n:长度，单位是**字符**。CHAR(10),该字段可以存放最多10个字符

  * 最大长度:255个字符

  * 表中每条记录该字段在磁盘上占据的空间是固定的，如果实际保存的字符不足指定的长度时，会在后面补充若干个空格来达到长度。

  * **优点:由于长度固定，因此查询速度快**

  * **缺点:磁盘占用存在浪费的情况**

* `VARCHAR(n)`:变长字符串

  * n:长度，单位是**字节**。VARCHAR(10),该字段保存的字符转换的字节最多10个。

  * 最大长度为:65535个字节

  * **优点:实际字段值占用多少字节就在磁盘上开辟多少字节。**

  * **缺点:长度不固定，因此查询性能慢**

* `TEXT(n)`:可变长字符

  n:长度，单位是**字符**。最大值为65535

### 3.日期类型

- `DATE`：可以保存年月日
- `TIME`：保存时分秒
- `DATETIME`：保存年月日时分秒
- `TIMESTAMP`: 时间戳，记录UTC时间。从1970-01-01 00:00:00到其表示的时间之间经过的毫秒

例：

```sql
CREATE TABLE userinfo(
	id INT,
	name VARCHAR(30),
	birth DATETIME,
	salary DOUBLE(7,2)
)
```

插入日期时，可以使用字符串格式，格式应当为:`yyyy-MM-dd hh:mm:ss`

- `MM`表示两个数字的"月"，`mm`表示两位数字的"分"

```sql
INSERT INTO userinfo VALUES(1,'张三','1992-08-02 11:23:56',5000.98)
```

如果日期类型使用的是`DATETIME`，那么在不指定时分秒时，默认为00:00:00

```sql
INSERT INTO userinfo VALUES(2,'李四','1989-06-30',9000)
```

`DATETIME`不能忽略年月日

```sql
INSERT INTO userinfo VALUES(3,'王五','13:25:33',12000)#报错
```

## 四、约束

约束就是为表中某个字段添加一些限制条件，只有符合条件时才可以对表中记录进行操作

**主键约束，外键约束，唯一性约束，非空约束**

### 1. 主键约束

**什么是主键(PRIMARY KEY)**：

* 该字段的值仅表达该表中唯一的一条记录

* 一张表只能有一个字段添加主键约束。该约束要求该字段:**非空且唯一**

### 2.主键约束 (NOT NULL)

添加了非空约束的字段:每条记录该字段的值都不能为NULL

例：

```sql
CREATE TABLE student(
	id INT PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	age INT(3),
	gender CHAR(1)
) 
```

* 使用`DESC`查看student表结构时可以体现出主键以及非空约束

```sql
DESC student
```

* 不能将`NULL`值插入到主键或者具有非空约束的字段上

```sql
# 当不指定id时，数据库会将NULL默认插入到id字段，这违背主键约束:
INSERT INTO student (name,age,gender) VALUES ('张三',22,'男');

# 不能将NULL值显示的插入到具有非空约束的name字段上:
INSERT INTO student VALUES(1,NULL,22,'男');
```

* 不能将重复的值插入到主键字段中

```sql
INSERT INTO student VALUES(1,'张三',22,'男');

# 不能再将1作为主键的值插入另一条记录。主键字段的值不可重复。
INSERT INTO student VALUES(1,'李四',33,'男');
```

* 主键的值可以由数据库自行维护

```sql
ALTER TABLE student CHANGE id id INT AUTO_INCREMENT;
```

* 当主键字段具有自增效果时，我们可以忽略主键值的插入

```sql
INSERT INTO student (name,age,gender) VALUES('李四',22,'男')
```

* 当主键字段具有自增效果时，我们可以显示的向ID字段插入NULL值.此时主键仍然自增(不推荐操作)

```sql
# 此时并不会将NULL值作为主键字段的值，而是使用自增的主键值。
INSERT INTO student VALUES(NULL,'王五',25,'女')
```

## 五、数据查询语言（DQL)

基本语法：

```sql
SELECT 子句
FROM 子句
JOIN... ON... 子句
WHERE 子句
GROUP BY 子句
HAVING 子句
ORDER BY 子句
```

### 1.SELECT 子句

一条DQL语句必须包含的两个子句分别为:SELECT子句和FROM子句

- SELECT 子句用于选定表中的字段，选定的字段会被包含在查询的结果集中
- FROM 子句用于指定查询的表

查看student表中所有记录，每条记录所有字段都要展示在结果集中。

```sql
SELECT * FROM student
# "*"在SELECT子句中表达的意思时查看表中所有字段。
```

SELECT子句中可以仅指定个别字段进行查询

```sql
# 查看每个学生的名字，年龄，性别
SELECT name,age,gender
FROM student
```

### 2. WHERE子句

**WHERE子句可以添加过滤条件，那么此时仅查询出满足该子句过滤条件的记录**

**比较运算符:=,>,>=,<,<=,<>**

例

- 查看所有大队长

  ```sql
  SELECT name,job 
  FROM student
  WHERE job='大队长'
  ```

- 查看除了'刘苍松'以外的其他老师的名字和年龄

  ```sql
  SELECT name,age
  FROM teacher
  WHERE name<>'刘苍松'
  ```

- 查看年龄在30岁以上的老师的名字和年龄(含30岁)

  ```sql
  SELECT name,age
  FROM teacher
  WHERE age>=30
  ```

在WHERE子句中可以使用OR,AND来连接多个过滤条件

- `AND`:与。都为真时才为真
- `OR`:或。都为假时才为假

例如

- 查看学生中7岁的大队长都有谁?

  ```sql
  SELECT name,age,job
  FROM student
  WHERE age=7 AND job='大队长'
  ```

- 查看班级号小于6的所有中队长都有谁?(班级号:class_id)

  ```sql
  SELECT name,job,class_id
  FROM student
  WHERE class_id<6 AND job='中队长'
  ```
